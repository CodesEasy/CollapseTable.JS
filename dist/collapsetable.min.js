/*!
 * CollapseTable v1.1.1
 * Lightweight, dependency-free JavaScript library that makes plain HTML tables responsive
 * by collapsing lower-priority columns into a per-row “details” panel with a +/− toggle.
 *
 * Author: Vishnu – https://vishnu.wiki
 * Company: Codes Easy – https://www.codeseasy.com
 *
 * License: MIT
 * -----------------------------------------------------------------------------
 * MIT License
 *
 * Copyright (c) 2025 Vishnu (Codes Easy)
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * -----------------------------------------------------------------------------
 *
 * Guarantees in this build:
 * - Table is forced to 100% width of its parent by default.
 * - Table headers and cells are left-aligned by default.
 * - Columns collapse based on priorities and width hints; details render as "Label: Value".
 * - Production-grade: resize fallbacks, hidden-container deferral, multi-TBODY support,
 *   accessibility improvements, attribute-aware updates, stable row IDs, setAll/unsetAll,
 *   per-row controls, detailsRender hook, and more.
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.CollapseTable=e()}("undefined"!=typeof self?self:this,function(){"use strict";const t=t=>"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,16);function e(t){return t?"string"==typeof t?t.startsWith("#")?document.getElementById(t.slice(1)):document.getElementById(t)||document.querySelector(t):t&&1===t.nodeType?t:null:null}function s(t){return t?"string"==typeof t?Array.from(document.querySelectorAll(t)):t instanceof Element?[t]:t instanceof NodeList||t instanceof HTMLCollection?Array.from(t):Array.isArray(t)?t.filter(t=>t instanceof Element):[]:[]}function i(t,e){const s=document.createElement(t);return e&&(s.className=e),s}function o(t,e,s){const i=o._store||(o._store=new WeakMap);let n=i.get(t);n||(n=new Set,i.set(t,n)),n.has(e)||(n.add(e),s())}function n(t,e){const s=Object.assign({},t);if(!e)return s;for(const i in e){if(!Object.prototype.hasOwnProperty.call(e,i))continue;const o=e[i];o&&"object"==typeof o&&!Array.isArray(o)?s[i]=n(t[i]||{},o):s[i]=o}return s}function r(t){if(!t)return!1;const e=window.getComputedStyle(t);return e&&"none"!==e.display&&"hidden"!==e.visibility}class a{constructor(t,e,s){if(!(t instanceof HTMLTableElement))throw new Error("CollapseTable: target is not a <table> element.");this.table=t,this.options=e,this.emit=s,this._rowKeyMap=new WeakMap,this._rowKeySeq=0,this._unsupportedSpan=!1,this._destroyed=!1,this._initOnce()}_initOnce(){if(function(){if(document.getElementById("ctbl-core-styles"))return;const t=document.createElement("style");t.id="ctbl-core-styles",t.type="text/css",t.appendChild(document.createTextNode("\n      .ctbl{width:100%;max-width:100%;table-layout:auto;border-collapse:separate;border-spacing:0;}\n      .ctbl th,.ctbl td{text-align:left;}\n      .ctbl-hide{display:none;}\n      .ctbl-vh{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}\n      .ctbl-control .ctbl-toggle{cursor:pointer;background:transparent;border:0;padding:0 8px;font:inherit;line-height:1.2;}\n      .ctbl-control .ctbl-toggle:focus{outline:2px solid #2684FF;outline-offset:2px;}\n      .ctbl-details-row[hidden]{display:none;}\n    ")),document.head.appendChild(t)}(),this.table.classList.contains(this.options.classNames.root)||this.table.classList.add(this.options.classNames.root),this.table.style.width||(this.table.style.width="100%"),this.table.style.tableLayout||(this.table.style.tableLayout=this.options.tableLayout),this.thead=this.table.tHead,!this.thead||!this.thead.rows.length)throw new Error("CollapseTable: table <thead> with at least one <tr> is required.");if(this.headerRow=this.thead.rows[0],this.tbodies=Array.from(this.table.tBodies||[]),!this.tbodies.length)throw new Error("CollapseTable: table <tbody> is required.");this._checkSpans(),this._ensureControlColumn(),this.headers=Array.from(this.headerRow.cells),this.ctrlIndex=0,this._buildColumns(),this._mountAllBodies(),this._refit(!0),this._observe()}_checkSpans(){const t=Array.from(this.headerRow.cells).some(t=>1!==t.colSpan||1!==t.rowSpan),e=this.tbodies.some(t=>Array.from(t.rows).some(t=>Array.from(t.cells).some(t=>1!==t.colSpan||1!==t.rowSpan)));(t||e)&&(this._unsupportedSpan=!0,o(this.table,"span-warning",()=>{console.warn("CollapseTable: <colspan> / <rowspan> detected. Responsive collapsing is disabled for this table; base styles still applied.")}))}_getWrapper(){return this.table.parentElement||this.table}_ensureControlColumn(){if(this.headerRow.cells[0]&&this.headerRow.cells[0].classList.contains(this.options.classNames.control)){const t=this.headerRow.cells[0];t.setAttribute("aria-hidden","true"),t.setAttribute("scope","col")}else{const t=i("th",this.options.classNames.control);t.setAttribute("aria-hidden","true"),t.setAttribute("scope","col"),this.headerRow.insertBefore(t,this.headerRow.firstChild);for(const t of this.tbodies)for(const e of Array.from(t.rows)){const t=i("td",this.options.classNames.control);e.insertBefore(t,e.firstChild)}}}_buildColumns(){const t=Array.from(this.headerRow.cells);t.forEach(t=>t.classList.remove(this.options.classNames.hide));const e=t=>{const e=Number(t.getAttribute(this.options.attrs.min))||0,s=Math.ceil(t.clientWidth||t.offsetWidth||0);return e>0?e:s>0?s:this.options.minWidthDefault},s=[],i=[];for(let o=0;o<t.length;o++){const n=t[o],r=0===o,a=n.getAttribute(this.options.attrs.priority),l=a?Number(a):r?1:o+1,h=r?this.options.controlWidth:e(n),c=r||1===l;s.push({index:o,th:n,priority:l,min:h,lock:c}),r||i.push(l)}return o(this.table,"priority-warn",()=>{const t=i.filter(t=>1===t).length;t>0&&console.warn("CollapseTable: Use priority=1 sparingly (never hidden). Found:",t);i.some(t=>Number.isNaN(t)||t<1)&&console.warn("CollapseTable: Some columns have invalid/missing data-priority; default ordering will be used.")}),this.columnsMeta=s,s}_mountAllBodies(){for(const t of this.tbodies)this._mountRowsInBody(t);this._clickHandler=t=>{const e=t.target.closest&&t.target.closest("button."+this.options.classNames.toggle);if(!e||!this.table.contains(e))return;t.preventDefault();const s=e.closest("tr");s&&this.toggle(s)},this._keyHandler=t=>{const e=t.target.closest&&t.target.closest("button."+this.options.classNames.toggle);if(e&&this.table.contains(e)&&("Enter"===t.key||" "===t.key)){t.preventDefault();const s=e.closest("tr");if(!s)return;this.toggle(s)}},this.table.addEventListener("click",this._clickHandler),this.table.addEventListener("keydown",this._keyHandler)}_mountRowsInBody(t){const e=Array.from(t.rows).filter(t=>!t.classList.contains(this.options.classNames.details));for(const t of e){if(!this._rowKeyMap.has(t)){const e=t.getAttribute("data-ctbl-key")||String(++this._rowKeySeq);this._rowKeyMap.set(t,e)}const e=t.cells[0];if(!e.querySelector("button."+this.options.classNames.toggle)){const s=this._detailsIdForRow(t),o=i("button",this.options.classNames.toggle);o.type="button",o.setAttribute("aria-expanded","false"),o.setAttribute("aria-controls",s),o.setAttribute("title",this.options.strings.toggleTitle),o.setAttribute("aria-label",this.options.strings.toggleTitle),o.innerHTML=this.options.icons.expand+`<span class="ctbl-vh">${this.options.strings.toggleTitle}</span>`,e.appendChild(o)}const s=t.nextElementSibling;if(!(s&&s.classList&&s.classList.contains(this.options.classNames.details))){const e=i("tr",this.options.classNames.details);e.classList.add("ctbl-details-row"),e.setAttribute("hidden","");const s=document.createElement("td");s.colSpan=this.headerRow.cells.length;const o=i("div",this.options.classNames.detailsInner);o.setAttribute("role","region"),o.setAttribute("aria-live","polite"),s.appendChild(o),e.appendChild(s),e.id=this._detailsIdForRow(t),t.insertAdjacentElement("afterend",e)}}}_observe(){this.wrapper=this._getWrapper();const e="undefined"!=typeof window&&window.ResizeObserver?window.ResizeObserver:null;if(e?(this._resizeObserver=new e(()=>{this._destroyed||t(()=>this._refit())}),this._resizeObserver.observe(this.wrapper),this.wrapper!==this.table&&this._resizeObserver.observe(this.table),this._headerResizeObserver=new e(()=>{this._destroyed||t(()=>this.refresh())}),this._headerResizeObserver.observe(this.headerRow)):(this._onWinResize=function(t,e){let s,i,o,n=0;return function(){const r=Date.now();i=this,o=arguments;const a=e-(r-n);a<=0||a>e?(s&&(clearTimeout(s),s=null),n=r,t.apply(i,o)):s||(s=setTimeout(()=>{n=Date.now(),s=null,t.apply(i,o)},a))}}(()=>{this._destroyed||this._refit()},100),window.addEventListener("resize",this._onWinResize)),this.options.deferWhenHidden&&"undefined"!=typeof window&&"IntersectionObserver"in window){const t=window.IntersectionObserver;this._intersectObserver=new t(t=>{for(const e of t)e.isIntersecting&&this._refit()},{root:null,threshold:.01}),this._intersectObserver.observe(this.table)}const s="undefined"!=typeof window&&(window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver);s&&(this._tbodyObservers=this.tbodies.map(t=>{const e=new s(()=>{this._mountRowsInBody(t),this._refit()});return e.observe(t,{childList:!0,subtree:!1}),e}),this._theadObserver=new s(t=>{let e=!1;for(const s of t)if("childList"===s.type||"attributes"===s.type&&("TH"===s.target.tagName||s.target===this.headerRow)){e=!0;break}e&&(this.headerRow=this.thead.rows[0],this.headers=Array.from(this.headerRow.cells),this._buildColumns(),this._mountAllBodies(),this._refit())}),this._theadObserver.observe(this.thead,{childList:!0,subtree:!0,attributes:!0,attributeFilter:[this.options.attrs.priority,this.options.attrs.min,this.options.attrs.label]}))}_detailsIdForRow(t){const e=this._rowKeyMap.get(t)||"x";return`${this.table.id||"ctbl"}-row-${e}-details`}_availableWidth(){const t=this.wrapper&&this.wrapper.clientWidth?this.wrapper.clientWidth:this.table&&this.table.clientWidth?this.table.clientWidth:"undefined"!=typeof window?window.innerWidth:0;return!(r(this.wrapper)&&r(this.table))&&this.options.deferWhenHidden?("undefined"!=typeof window?window.innerWidth:1024)||1024:t>0?t:("undefined"!=typeof window?window.innerWidth:1024)||1024}_applyVisibility(t){for(const e of this.columnsMeta){const s=t.has(e.index);e.th.classList.toggle(this.options.classNames.hide,s)}for(const e of this.tbodies)for(const s of Array.from(e.rows))if(!s.classList.contains(this.options.classNames.details))for(const e of this.columnsMeta){const i=s.cells[e.index];i&&i.classList.toggle(this.options.classNames.hide,t.has(e.index))}}_firstVisibleCellText(t,e){for(const s of this.columnsMeta)if(0!==s.index&&!e.has(s.index)){const e=t.cells[s.index];if(e){const t=(e.textContent||"").trim();if(t)return t}}return""}_renderDetailsForRow(t,e,s){const o=e.querySelector("."+this.options.classNames.detailsInner);if(!o)return;o.innerHTML="";const n=this._firstVisibleCellText(t,s);n?o.setAttribute("aria-label",`Details for ${n}`):o.setAttribute("aria-label","Row details");const r=Array.from(t.cells);if("function"==typeof this.options.detailsRender){const e=this.columnsMeta.filter(t=>s.has(t.index)&&0!==t.index),i=this.options.detailsRender(t,e,r);if(i instanceof Node)return void o.appendChild(i);if("string"==typeof i)return void(o.innerHTML=i)}for(const t of this.columnsMeta){if(0===t.index)continue;if(!s.has(t.index))continue;const e=(t.th.getAttribute(this.options.attrs.label)||t.th.textContent||"").trim(),n=i("div",this.options.classNames.detail),a=i("span",this.options.classNames.name),l=i("span",this.options.classNames.value);a.textContent=e?e+": ":"",l.innerHTML=r[t.index]?.innerHTML??"",n.appendChild(a),n.appendChild(l),o.appendChild(n)}}_updateTogglesVisibility(t,e){const s=!t,i=this.headerRow&&this.headerRow.cells&&this.headerRow.cells[0];i&&i.classList.toggle(this.options.classNames.hide,s);for(const i of this.tbodies){const o=Array.from(i.rows).filter(t=>!t.classList.contains(this.options.classNames.details));for(const i of o){const o=i.cells&&i.cells[0];o&&o.classList.toggle(this.options.classNames.hide,s);const n=i.querySelector("button."+this.options.classNames.toggle);if(!n)continue;n.style.visibility=t?"visible":"hidden";const r=this.columnsMeta.filter(t=>e.has(t.index)&&0!==t.index).length,a=this.options.strings.toggleTitle;n.setAttribute("aria-label",t?`${a} (${r} hidden)`:a);const l=i.nextElementSibling,h="true"===n.getAttribute("aria-expanded");l&&l.classList.contains(this.options.classNames.details)&&!l.hidden&&h&&this._renderDetailsForRow(i,l,e)}}}_refit(t=!1){if(this._unsupportedSpan)return;const e=this._availableWidth(),s=function(t,e){const s=t.map(t=>({index:t.index,min:t.min,priority:t.priority,lock:!!t.lock,hidden:!1})),i=()=>s.filter(t=>!t.hidden).reduce((t,e)=>t+e.min,0);let o=200;for(;i()>e&&o-- >0;){const t=s.filter(t=>!t.hidden&&!t.lock&&0!==t.index).sort((t,e)=>e.priority-t.priority||e.min-t.min)[0];if(!t)break;t.hidden=!0}o=200;let n=!0;for(;n&&o-- >0;){n=!1;const t=s.filter(t=>t.hidden).sort((t,e)=>t.priority-e.priority||t.min-e.min);for(const s of t)s.hidden=!1,i()<=e?n=!0:s.hidden=!0}return new Set(s.filter(t=>t.hidden).map(t=>t.index))}(this.columnsMeta.map(t=>({index:t.index,min:t.min,priority:t.priority,lock:0===t.index||1===t.priority})),e);this._applyVisibility(s);const i=Array.from(s).some(t=>0!==t);this._updateTogglesVisibility(i,s),this.emit("refit",{table:this.table,initial:t,anyHidden:i})}toggle(t){if(!t||t.classList.contains(this.options.classNames.details))return;const e=t.querySelector("button."+this.options.classNames.toggle),s=t.nextElementSibling;if(!e||!s||!s.classList.contains(this.options.classNames.details))return;const i="true"===e.getAttribute("aria-expanded");if(i)e.setAttribute("aria-expanded","false"),e.innerHTML=this.options.icons.expand+`<span class="ctbl-vh">${this.options.strings.show}</span>`,s.hidden=!0,this.emit("collapse",{table:this.table,row:t});else{e.setAttribute("aria-expanded","true"),e.innerHTML=this.options.icons.collapse+`<span class="ctbl-vh">${this.options.strings.hide}</span>`;const i=new Set(this.columnsMeta.filter(t=>t.th.classList.contains(this.options.classNames.hide)).map(t=>t.index));this._renderDetailsForRow(t,s,i),s.hidden=!1,this.emit("expand",{table:this.table,row:t})}this.emit("toggle",{table:this.table,row:t,expanded:!i})}expandAll(){if(this.columnsMeta.some(t=>0!==t.index&&t.th.classList.contains(this.options.classNames.hide)))for(const t of this.tbodies){const e=Array.from(t.rows).filter(t=>!t.classList.contains(this.options.classNames.details));for(const t of e){const e=t.querySelector("button."+this.options.classNames.toggle);e&&("true"!==e.getAttribute("aria-expanded")&&this.toggle(t))}}}collapseAll(){for(const t of this.tbodies){const e=Array.from(t.rows).filter(t=>!t.classList.contains(this.options.classNames.details));for(const t of e){const e=t.querySelector("button."+this.options.classNames.toggle);e&&("true"===e.getAttribute("aria-expanded")&&this.toggle(t))}}}expandRow(t){const e=this._resolveDataRow(t);if(!e)return;const s=e.querySelector("button."+this.options.classNames.toggle);s&&"true"!==s.getAttribute("aria-expanded")&&this.toggle(e)}collapseRow(t){const e=this._resolveDataRow(t);if(!e)return;const s=e.querySelector("button."+this.options.classNames.toggle);s&&"true"===s.getAttribute("aria-expanded")&&this.toggle(e)}_resolveDataRow(t){if(t instanceof HTMLTableRowElement)return t;const e=Number(t);if(!Number.isFinite(e))return null;return this.tbodies.flatMap(t=>Array.from(t.rows).filter(t=>!t.classList.contains(this.options.classNames.details)))[e]||null}refresh(){this.columnsMeta.forEach((t,e)=>{if(0===e)return void(t.min=this.options.controlWidth);const s=Number(t.th.getAttribute(this.options.attrs.min))||0,i=Math.ceil(t.th.clientWidth||t.th.offsetWidth||0);t.min=s>0?s:i>0?i:this.options.minWidthDefault}),this._refit()}destroy(){this._destroyed=!0,this._resizeObserver&&this._resizeObserver.disconnect&&this._resizeObserver.disconnect(),this._headerResizeObserver&&this._headerResizeObserver.disconnect&&this._headerResizeObserver.disconnect(),this._intersectObserver&&this._intersectObserver.disconnect&&this._intersectObserver.disconnect(),this._tbodyObservers&&this._tbodyObservers.forEach(t=>t.disconnect&&t.disconnect()),this._theadObserver&&this._theadObserver.disconnect&&this._theadObserver.disconnect(),this._clickHandler&&this.table.removeEventListener("click",this._clickHandler),this._keyHandler&&this.table.removeEventListener("keydown",this._keyHandler),this._onWinResize&&window.removeEventListener("resize",this._onWinResize);for(const t of this.columnsMeta)t.th.classList.remove(this.options.classNames.hide);for(const t of this.tbodies)for(const e of Array.from(t.rows))if(!e.classList.contains(this.options.classNames.details))for(const t of this.columnsMeta){const s=e.cells[t.index];s&&s.classList.remove(this.options.classNames.hide)}for(const t of this.tbodies)for(const e of Array.from(t.rows))e.classList.contains(this.options.classNames.details)&&e.remove();this.table.querySelectorAll("button."+this.options.classNames.toggle).forEach(t=>t.remove()),this.emit("destroy",{table:this.table})}}return class{constructor(t={}){this.defaults={controlWidth:46,minWidthDefault:140,tableLayout:"auto",deferWhenHidden:!0,attrs:{priority:"data-priority",min:"data-min",label:"data-label"},classNames:{root:"ctbl",control:"ctbl-control",toggle:"ctbl-toggle",details:"ctbl-details",detailsInner:"ctbl-details-inner",detail:"ctbl-detail",name:"ctbl-name",value:"ctbl-value",hide:"ctbl-hide"},icons:{expand:"+",collapse:"−"},strings:{toggleTitle:"Show more",show:"Show details",hide:"Hide details"},detailsRender:void 0},this.options=n(this.defaults,t),this._tables=new Map,this._events={}}set(t,s={}){const i=e(t);if(!i)throw new Error("CollapseTable.set: target not found.");if(!(i instanceof HTMLTableElement))throw new Error("CollapseTable.set: target must be a <table> element or its id.");if(this._tables.has(i)){const t=this._tables.get(i);return t.options=n(this.options,s),t.table.style.tableLayout&&t.table.style.tableLayout===t.options.tableLayout||(t.table.style.tableLayout=t.options.tableLayout),t.refresh(),t}const o=n(this.options,s),r=new a(i,o,this._emit.bind(this));return this._tables.set(i,r),r}setAll(t,e={}){return s(t).filter(t=>t instanceof HTMLTableElement).map(t=>this.set(t,e))}unset(t){const s=e(t);if(!s)return;const i=this._tables.get(s);i&&(i.destroy(),this._tables.delete(s))}unsetAll(t){const e=s(t).filter(t=>t instanceof HTMLTableElement);for(const t of e)this.unset(t)}refresh(t){if(!t)return void this._tables.forEach(t=>t.refresh());const s=e(t);if(!s)return;const i=this._tables.get(s);i&&i.refresh()}expandAll(t){if(t){const s=e(t),i=this._tables.get(s);i&&i.expandAll()}else this._tables.forEach(t=>t.expandAll())}collapseAll(t){if(t){const s=e(t),i=this._tables.get(s);i&&i.collapseAll()}else this._tables.forEach(t=>t.collapseAll())}expandRow(t,s){const i=e(t),o=i&&this._tables.get(i);o&&o.expandRow(s)}collapseRow(t,s){const i=e(t),o=i&&this._tables.get(i);o&&o.collapseRow(s)}getOptions(){return n({},this.options)}updateOptions(t){this.options=n(this.options,t),this._tables.forEach(e=>{e.options=n(e.options,t),t.tableLayout&&(e.table.style.tableLayout=e.options.tableLayout),e.refresh()})}on(t,e){this._events[t]||(this._events[t]=new Set),this._events[t].add(e)}off(t,e){this._events[t]&&this._events[t].delete(e)}_emit(t,e){if(this._events[t])for(const s of this._events[t])try{s(e)}catch(t){}}static get version(){return"1.1.1"}}});
//# sourceMappingURL=collapsetable.min.js.map