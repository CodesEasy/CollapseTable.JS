/*!
 * CollapseTable v1.0.0
 * Lightweight, dependency-free JavaScript library that makes plain HTML tables responsive
 * by collapsing lower-priority columns into an inline, per-row “details” area with a +/− toggle.
 *
 * Author: Vishnu – https://vishnu.wiki
 * Company: Codes Easy – https://www.codeseasy.com
 *
 * License: MIT
 * -----------------------------------------------------------------------------
 * MIT License
 *
 * Copyright (c) 2025 Vishnu (Codes Easy)
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * -----------------------------------------------------------------------------
 *
 * Guarantees in this build:
 * - The target table is forced to 100% width of its parent (and screen) by default.
 * - Table headers and cells are left-aligned by default.
 * - Collapsible table according to screen width
 *
 * Quick Start:
 *   <script src="/assets/js/CollapseTable.js"><\/script>
 *   <table id="table1">
 *     <thead>
 *       <tr>
 *         <th data-priority="1" data-min="200">Project</th>
 *         <th data-priority="2" data-min="160">Client</th>
 *         <th data-priority="4" data-min="120">Budget</th>
 *         <th data-priority="3" data-min="130">Status</th>
 *         <th data-priority="5" data-min="140">Start</th>
 *         <th data-priority="6" data-min="140">End</th>
 *       </tr>
 *     </thead>
 *     <tbody>...</tbody>
 *   </table>
 *
 *   <script>
 *     var collapseTable = new CollapseTable();
 *     collapseTable.set("table1");
 *   </script>
 *
 * Notes:
 * - Lower data-priority number = more important (hidden later). data-priority="1" is never hidden.
 * - data-min (px) is a hint used for fit calculations. If omitted, an initial measured width is used.
 * - A control column (+/− button) is inserted as the first column if not already present.
 * - Accessible: aria-expanded, aria-controls, keyboard toggling with Enter/Space.
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.CollapseTable=e()}("undefined"!=typeof self?self:this,function(){"use strict";function t(t){return t?"string"==typeof t?t.startsWith("#")?document.getElementById(t.slice(1)):document.getElementById(t)||document.querySelector(t):t&&1===t.nodeType?t:null:null}function e(t,e){const s=document.createElement(t);return e&&(s.className=e),s}function s(t,e){const i=Object.assign({},t);if(!e)return i;for(const o in e){if(!Object.prototype.hasOwnProperty.call(e,o))continue;const n=e[o];n&&"object"==typeof n&&!Array.isArray(n)?i[o]=s(t[o]||{},n):i[o]=n}return i}class i{constructor(t,e,s){if(!(t instanceof HTMLTableElement))throw new Error("CollapseTable: target is not a <table> element.");this.table=t,this.options=e,this.emit=s,this._initOnce()}_initOnce(){if(function(){if(document.getElementById("ctbl-core-styles"))return;const t=document.createElement("style");t.id="ctbl-core-styles",t.type="text/css",t.appendChild(document.createTextNode("\n      .ctbl{width:100% !important;max-width:100% !important;table-layout:auto !important;border-collapse:separate;border-spacing:0;}\n      .ctbl th,.ctbl td{text-align:left;}\n      .ctbl-hide{display:none !important;}\n      .ctbl-vh{position:absolute!important;width:1px!important;height:1px!important;padding:0!important;margin:-1px!important;overflow:hidden!important;clip:rect(0,0,0,0)!important;white-space:nowrap!important;border:0!important;}\n    ")),document.head.appendChild(t)}(),this.table.classList.contains(this.options.classNames.root)||this.table.classList.add(this.options.classNames.root),this.table.style.width||(this.table.style.width="100%"),this.wrapper=this._getWrapper(),this.thead=this.table.tHead,!this.thead||!this.thead.rows.length)throw new Error("CollapseTable: table <thead> with at least one <tr> is required.");if(this.headerRow=this.thead.rows[0],this.tbody=this.table.tBodies[0],!this.tbody)throw new Error("CollapseTable: table <tbody> is required.");this._ensureControlColumn(),this.headers=Array.from(this.headerRow.cells),this.ctrlIndex=0,this.columns=this._buildColumns(),this._mountRows(),this._refit(!0),this._observe()}_getWrapper(){return this.table.parentElement||this.table}_ensureControlColumn(){if(this.headerRow.cells[0]&&this.headerRow.cells[0].classList.contains(this.options.classNames.control)){const t=this.headerRow.cells[0];t.setAttribute("aria-hidden","true"),t.setAttribute("scope","col")}else{const t=e("th",this.options.classNames.control);t.setAttribute("aria-hidden","true"),t.setAttribute("scope","col"),this.headerRow.insertBefore(t,this.headerRow.firstChild);for(const t of Array.from(this.tbody.rows)){const s=e("td",this.options.classNames.control);t.insertBefore(s,t.firstChild)}}}_buildColumns(){const t=[],e=Array.from(this.headerRow.cells);e.forEach(t=>t.classList.remove(this.options.classNames.hide));const s=t=>{const e=Number(t.getAttribute(this.options.attrs.min))||0,s=Math.ceil(t.clientWidth||t.offsetWidth||0);return e>0?e:s>0?s:this.options.minWidthDefault};for(let i=0;i<e.length;i++){const o=e[i],n=0===i,r=o.getAttribute(this.options.attrs.priority),l=r?Number(r):n?1:i+1,a=n?this.options.controlWidth:s(o),h=n||1===l;t.push({index:i,th:o,priority:l,min:a,lock:h,hidden:!1})}return t}_mountRows(){const t=Array.from(this.tbody.rows);for(const s of t){if(s.classList.contains(this.options.classNames.details))continue;const t=s.cells[0];if(!t.querySelector("button."+this.options.classNames.toggle)){const i=this._detailsIdForRow(s),o=e("button",this.options.classNames.toggle);o.type="button",o.setAttribute("aria-expanded","false"),o.setAttribute("aria-controls",i),o.setAttribute("title",this.options.strings.toggleTitle),o.innerHTML=this.options.icons.expand+`<span class="ctbl-vh">${this.options.strings.toggleTitle}</span>`,t.appendChild(o)}if(!s.nextElementSibling||!s.nextElementSibling.classList?.contains(this.options.classNames.details)){const t=e("tr",this.options.classNames.details);t.setAttribute("hidden","");const i=document.createElement("td");i.colSpan=this.headerRow.cells.length;const o=e("div",this.options.classNames.detailsInner);i.appendChild(o),t.appendChild(i),t.id=this._detailsIdForRow(s),s.insertAdjacentElement("afterend",t)}}this._clickHandler=t=>{const e=t.target.closest("button."+this.options.classNames.toggle);if(!e)return;t.preventDefault();const s=e.closest("tr");this.toggle(s)},this._keyHandler=t=>{const e=t.target.closest("button."+this.options.classNames.toggle);if(e&&("Enter"===t.key||" "===t.key)){t.preventDefault();const s=e.closest("tr");this.toggle(s)}},this.table.addEventListener("click",this._clickHandler),this.table.addEventListener("keydown",this._keyHandler)}_observe(){const t="undefined"!=typeof window&&window.ResizeObserver?window.ResizeObserver:class{observe(){}disconnect(){}};this._resizeObserver=new t(()=>{var t;t=()=>this._refit(),"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,16)}),this._resizeObserver.observe(this.wrapper),this.wrapper!==this.table&&this._resizeObserver.observe(this.table);const e="undefined"!=typeof window&&(window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver);e&&(this._tbodyObserver=new e(()=>{this._mountRows(),this._refit()}),this._tbodyObserver.observe(this.tbody,{childList:!0,subtree:!1}),this._theadObserver=new e(()=>{this.headerRow=this.thead.rows[0],this.headers=Array.from(this.headerRow.cells),this.columns=this._buildColumns(),this._mountRows(),this._refit()}),this._theadObserver.observe(this.thead,{childList:!0,subtree:!0}))}_detailsIdForRow(t){const e=Array.from(this.tbody.rows).filter(t=>!t.classList.contains(this.options.classNames.details)).indexOf(t);return`${this.table.id||"ctbl"}-row-${e}-details`}_refit(t=!1){for(const t of this.columns)t.hidden=!1;this._applyColumnVisibility();const e=this._availableWidth(),s=()=>this.columns.filter(t=>!t.hidden).reduce((t,e)=>t+e.min,0);let i=100;for(;s()>e&&i-- >0;){const t=this.columns.filter(t=>!t.hidden&&!t.lock&&0!==t.index).sort((t,e)=>e.priority-t.priority||e.min-t.min)[0];if(!t)break;t.hidden=!0,this._applyColumnVisibility()}i=100;let o=!0;for(;o&&i-- >0;){o=!1;const t=this.columns.filter(t=>t.hidden).sort((t,e)=>t.priority-e.priority||t.min-e.min);for(const i of t)i.hidden=!1,this._applyColumnVisibility(),s()<=e?o=!0:(i.hidden=!0,this._applyColumnVisibility())}const n=this.columns.some(t=>t.hidden&&0!==t.index),r=Array.from(this.tbody.rows).filter(t=>!t.classList.contains(this.options.classNames.details));for(const t of r){const e=t.querySelector("button."+this.options.classNames.toggle);e&&(e.style.visibility=n?"visible":"hidden");const s=t.nextElementSibling;s&&s.classList.contains(this.options.classNames.details)&&!s.hidden&&this._renderDetailsForRow(t,s)}this.emit("refit",{table:this.table,initial:t,anyHidden:n})}_availableWidth(){const t=this.wrapper&&this.wrapper.clientWidth||this.table&&this.table.clientWidth||("undefined"!=typeof window?window.innerWidth:0)||0;return t>0?t:("undefined"!=typeof window?window.innerWidth:1024)||1024}_applyColumnVisibility(){for(const t of this.columns)t.th.classList.toggle(this.options.classNames.hide,t.hidden);for(const t of Array.from(this.tbody.rows))if(!t.classList.contains(this.options.classNames.details))for(const e of this.columns){const s=t.cells[e.index];s&&s.classList.toggle(this.options.classNames.hide,e.hidden)}}_renderDetailsForRow(t,s){const i=s.querySelector("."+this.options.classNames.detailsInner);if(!i)return;i.innerHTML="";const o=Array.from(t.cells),n=this.columns.filter(t=>t.hidden&&0!==t.index);for(const t of n){const s=(t.th.getAttribute(this.options.attrs.label)||t.th.textContent||"").trim(),n=e("div",this.options.classNames.detail),r=e("span",this.options.classNames.name),l=e("span",this.options.classNames.value);r.textContent=s?s+": ":"",l.innerHTML=o[t.index]?.innerHTML??"",n.appendChild(r),n.appendChild(l),i.appendChild(n)}}toggle(t){if(!t||t.classList.contains(this.options.classNames.details))return;const e=t.querySelector("button."+this.options.classNames.toggle),s=t.nextElementSibling;if(!e||!s||!s.classList.contains(this.options.classNames.details))return;const i="true"===e.getAttribute("aria-expanded");i?(e.setAttribute("aria-expanded","false"),e.innerHTML=this.options.icons.expand+`<span class="ctbl-vh">${this.options.strings.show}</span>`,s.hidden=!0,this.emit("collapse",{table:this.table,row:t})):(e.setAttribute("aria-expanded","true"),e.innerHTML=this.options.icons.collapse+`<span class="ctbl-vh">${this.options.strings.hide}</span>`,this._renderDetailsForRow(t,s),s.hidden=!1,this.emit("expand",{table:this.table,row:t})),this.emit("toggle",{table:this.table,row:t,expanded:!i})}expandAll(){if(!this.columns.some(t=>t.hidden&&0!==t.index))return;const t=Array.from(this.tbody.rows).filter(t=>!t.classList.contains(this.options.classNames.details));for(const e of t){const t=e.querySelector("button."+this.options.classNames.toggle);t&&("true"!==t.getAttribute("aria-expanded")&&this.toggle(e))}}collapseAll(){const t=Array.from(this.tbody.rows).filter(t=>!t.classList.contains(this.options.classNames.details));for(const e of t){const t=e.querySelector("button."+this.options.classNames.toggle);t&&("true"===t.getAttribute("aria-expanded")&&this.toggle(e))}}refresh(){this.columns.forEach((t,e)=>{if(0===e)return void(t.min=this.options.controlWidth);const s=Number(t.th.getAttribute(this.options.attrs.min))||0,i=Math.ceil(t.th.clientWidth||t.th.offsetWidth||0);t.min=s>0?s:i>0?i:this.options.minWidthDefault}),this._refit()}destroy(){this._resizeObserver&&this._resizeObserver.disconnect&&this._resizeObserver.disconnect(),this._tbodyObserver&&this._tbodyObserver.disconnect&&this._tbodyObserver.disconnect(),this._theadObserver&&this._theadObserver.disconnect&&this._theadObserver.disconnect(),this._clickHandler&&this.table.removeEventListener("click",this._clickHandler),this._keyHandler&&this.table.removeEventListener("keydown",this._keyHandler);for(const t of this.columns)t.th.classList.remove(this.options.classNames.hide);for(const t of Array.from(this.tbody.rows))if(!t.classList.contains(this.options.classNames.details))for(const e of this.columns){const s=t.cells[e.index];s&&s.classList.remove(this.options.classNames.hide)}for(const t of Array.from(this.tbody.rows))t.classList.contains(this.options.classNames.details)&&t.remove();this.table.querySelectorAll("button."+this.options.classNames.toggle).forEach(t=>t.remove()),this.emit("destroy",{table:this.table})}}return class{constructor(t={}){this.defaults={controlWidth:46,minWidthDefault:140,attrs:{priority:"data-priority",min:"data-min",label:"data-label"},classNames:{root:"ctbl",control:"ctbl-control",toggle:"ctbl-toggle",details:"ctbl-details",detailsInner:"ctbl-details-inner",detail:"ctbl-detail",name:"ctbl-name",value:"ctbl-value",hide:"ctbl-hide"},icons:{expand:"+",collapse:"−"},strings:{toggleTitle:"Show more",show:"Show details",hide:"Hide details"}},this.options=s(this.defaults,t),this._tables=new Map,this._events={}}set(e,o={}){const n=t(e);if(!n)throw new Error("CollapseTable.set: target not found.");if(!(n instanceof HTMLTableElement))throw new Error("CollapseTable.set: target must be a <table> element or its id.");if(this._tables.has(n)){const t=this._tables.get(n);return t.options=s(this.options,o),t.refresh(),t}const r=s(this.options,o),l=new i(n,r,this._emit.bind(this));return this._tables.set(n,l),l}unset(e){const s=t(e);if(!s)return;const i=this._tables.get(s);i&&(i.destroy(),this._tables.delete(s))}refresh(e){if(!e)return void this._tables.forEach(t=>t.refresh());const s=t(e);if(!s)return;const i=this._tables.get(s);i&&i.refresh()}expandAll(e){if(e){const s=t(e),i=this._tables.get(s);i&&i.expandAll()}else this._tables.forEach(t=>t.expandAll())}collapseAll(e){if(e){const s=t(e),i=this._tables.get(s);i&&i.collapseAll()}else this._tables.forEach(t=>t.collapseAll())}on(t,e){this._events[t]||(this._events[t]=new Set),this._events[t].add(e)}off(t,e){this._events[t]&&this._events[t].delete(e)}_emit(t,e){if(this._events[t])for(const s of this._events[t])try{s(e)}catch(t){}}static get version(){return"1.0.0"}}});
//# sourceMappingURL=collapsetable.min.js.map